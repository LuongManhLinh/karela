**Goal:** Implement a fully functional, highly responsive, and aesthetically consistent frontend for the `core-agent` FastAPI backend using **Next.js (App Router), TypeScript, and Material UI (MUI)**.

### Part 1: Mandatory Backend Analysis

**CRITICAL REQUIREMENT:** You **MUST** analyze the specified backend files before writing any frontend code to ensure strict adherence to API contracts and data flow. The frontend implementation must **EXACTLY MATCH** the backend mechanisms.

1.  **Required Backend Read Scope:**
    * `feature/chat/router.py`
    * `feature/chat/schemas.py`
    * `feature/defect/router.py`
    * `feature/defect/schemas.py`
    * `feature/user/router.py`
    * `feature/user/schemas.py`
    * `integrations/jira/router.py` (Focus on the `/oauth/start` redirect logic).

2.  **Analysis Focus:**
    * Define TypeScript interfaces (in `types/`) that mirror the Pydantic schemas found in `schemas.py`.
    * Define service functions (in `services/`) that map directly to the endpoints in `router.py`.

### Part 2: Frontend Architecture and Conventions

1.  **Core Technologies:** Next.js (using the **App Router** structure), TypeScript, and Material UI (MUI).
2.  **Folder Structure:** Define the project folders exactly as follows:
    * `app/`: For all Next.js pages and route groups.
    * `types/`: To store all TypeScript data schemas (interfaces, types).
    * `services/`: To store all TypeScript files responsible for fetching and handling data from the backend.
    * `components/`: To store all reusable React components.
3.  **Component Design:** Follow the principle of separation. **Do not create complex, monolithic components.** Break down large components into smaller, reusable, atomic components.
4.  **Styling and Theming:**
    * Implement a professional **Dark Mode / Light Mode** toggle using the MUI Theme provider. The UI must be fully functional and optimized in both modes.
    * Ensure **UI Consistency** across all pages. The two-panel layout pattern used for **Analyze Defect** and **Chat** must look and behave similarly.
5.  **Package Installation:** Feel free to install necessary packages (e.g., `react-polling`, `axios`, `mui/icons-material`, etc.) to achieve the functionalities.
6. **Error Handling:** Implement robust error handling for all API calls, displaying user-friendly error messages using MUI components (e.g., Snackbars, Alerts).
7. **Loading States:** Implement loading indicators (using CircularProgress or Skeleton) for all asynchronous operations to enhance user experience.
8. **Accessibility:** Ensure all components are accessible, following best practices for keyboard navigation and screen reader support.

### Part 3: Feature Specifications

#### 3.1 User Management (`/login`, `/register`, `/profile`)

1.  **Authentication:** Implement pages for user registration and login.
2.  **Jira Connection Flow (Post-Auth):**
    * After a successful login, check the user's connection status (querying the appropriate backend endpoint defined in `feature/user/router.py`).
    * If the Jira connection is missing, automatically initiate the OAuth connection process. This involves calling the backend endpoint that triggers the redirect (e.g., an endpoint which internally calls the one redirecting to `/oauth/start` in `integrations/jira/router.py`).
    * Upon successful OAuth completion (user is redirected back to the frontend), redirect the user automatically to the main application page (e.g., `/chat`).
3.  **Profile Page:** Implement functionality for displaying user information and allowing the user to change their password, based on the API endpoints.

#### 3.2 Analyze Defect Page (`/analyze`)

1.  **Input/Session Start:** Implement a form/header component where the user can select an existing **Connection**, enter the **Project Key** (mandatory), and enter the **Story Key** (optional). Submitting this form should initiate a new defect analysis session (check `feature/defect/router.py`).
2.  **Layout:** Use a **two-panel layout**:
    * **Left Panel (e.g., 30% width):** Display a list of all historical defect analysis sessions, showing a brief summary (e.g., Project Key, time, status). This list should be clickable.
    * **Right Panel (e.g., 70% width):** Display the detailed results of the currently selected analysis session. This panel should handle rendering structured data returned by the backend (check `feature/defect/schemas.py`).

#### 3.3 Chat Page (`/chat`) - The **ChatGPT Style UI**

1.  **Input/Session Start:** Implement the session start form in the header/sidebar (same input requirements as 3.2: Connection, Project Key, Story Key). The user also enters their initial **message** to start the chat.
2.  **Layout:** Use a **two-panel layout** that mimics the look and feel of the ChatGPT web interface:
    * **Left Panel (Sidebar):** Display a list of all historical chat session summaries (titles, creation time, etc.).
    * **Right Panel (Main):** The primary chat window, featuring message bubbles and the input area.
3.  **Proposal Data UI:**
    * Check for the existence of **Proposal Data** within the session structure (defined in `feature/chat/schemas.py`).
    * If proposal data exists, display it in a prominent, dedicated UI element **above the chat message input text area**. This element **must be a collapsible/open-close tab or accordion**, allowing the user to hide or show the proposal content.
4.  **Message Type Rendering (6 Distinct UIs):** Implement unique and easily distinguishable styling for all message types:

    | Message Type | UI Display Requirement | Interaction |
    | :--- | :--- | :--- |
    | `user` | Standard chat bubble (e.g., primary color background). | N/A |
    | `agent` | Standard chat bubble (e.g., light gray/dark gray background). | N/A |
    | `error` | Highly visible error component (e.g., red background, error icon, centered text). | N/A |
    | `agent_function_call` | Render the function name/arguments in a small, compact, **collapsible UI element (tab/accordion)**. | **MUST be collapsed by default** and expandable by the user. |
    | `tool` | Render the tool output/logs in a small, compact, **collapsible UI element (tab/accordion)**. | **MUST be collapsed by default** and expandable by the user. |
    | `analysis_progress` | Display the current `status` (PENDING, IN_PROGRESS, COMPLETED, FAILED). | **Polling Mechanism:** If status is `PENDING` or `IN_PROGRESS`, implement client-side **polling (e.g., every 5 seconds)** to automatically fetch the updated message status until it resolves to `COMPLETED` or `FAILED`. |
***
!